<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Pemesanan Servis</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        body { font-family: Arial, sans-serif; background-color: #f4f7f9; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #25d366; margin-bottom: 25px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="text"], input[type="tel"], select, textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { background-color: #25d366; color: white; padding: 12px; border: none; border-radius: 5px; width: 100%; font-size: 18px; cursor: pointer; transition: background 0.3s; }
        button:hover { background-color: #128c7e; }
        .success-message { text-align: center; color: #28a745; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body>

<div class="container">
    <h2><i class="fas fa-motorcycle"></i> Buat Permintaan Servis Baru</h2>
    <form id="orderForm">
        
        <label for="custName">Nama Pelanggan:</label>
        <input type="text" id="custName" name="custName" required>

        <label for="custWa">Nomor WhatsApp (Cth: 6281xxxxxx):</label>
        <input type="tel" id="custWa" name="custWa" required pattern="[0-9]{10,15}">

        <label for="vehicleType">Jenis Kendaraan:</label>
        <select id="vehicleType" name="vehicleType" required>
            <option value="">Pilih Jenis</option>
            <option value="motor">Motor</option>
            <option value="mobil">Mobil</option>
        </select>

        <label for="issueDesc">Deskripsi Kerusakan/Keluhan:</label>
        <textarea id="issueDesc" name="issueDesc" rows="4" required></textarea>

        <button type="submit">Kirim Pesanan</button>
        <p id="message" class="success-message"></p>
    </form>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
    import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js"; 

    // GANTI DENGAN KONFIGURASI FIREBASE ANDA
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        // ... lainnya
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const orderForm = document.getElementById('orderForm');
    const messageElement = document.getElementById('message');

    orderForm.addEventListener('submit', async function(event) {
        event.preventDefault();
        messageElement.textContent = "Mengirim pesanan...";
        
        try {
            const formData = new FormData(orderForm);
            
            // Siapkan data untuk dikirim ke Firestore
            const newOrderData = {
                custName: formData.get('custName'),
                custWa: formData.get('custWa'),
                vehicleType: formData.get('vehicleType'),
                issueDesc: formData.get('issueDesc'),
                status: 'pending', // Status awal
                mekanikId: null,   // Belum diklaim
                total: 0,          // Biaya awal
                createdAt: serverTimestamp()
            };

            // Tambahkan dokumen ke koleksi 'new_orders'
            const docRef = await addDoc(collection(db, "new_orders"), newOrderData);

            messageElement.textContent = `Pesanan berhasil! ID Tiket Anda: ${docRef.id}. Mengalihkan...`;
            
            // Redirect ke halaman status dengan ID tiket
            setTimeout(() => {
                window.location.href = `dashboard-customer.html?ticketId=${docRef.id}`;
            }, 2000);

        } catch (e) {
            console.error("Gagal menambahkan dokumen:", e);
            messageElement.textContent = "Gagal mengirim pesanan. Cek koneksi & aturan Firebase Anda.";
        }
    });
</script>
</body>
</html>

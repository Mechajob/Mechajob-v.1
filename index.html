<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Mekanik TP - Modular</title>
    <style>
        :root {
            --primary: #d32f2f;
            --secondary: #1976d2;
            --success: #2e7d32;
            --bg: #f8fafc;
            --text: #334155;
        }

        * { box-sizing: border-box; font-family: 'Inter', system-ui, sans-serif; }
        
        body { background-color: var(--bg); margin: 0; padding: 15px; color: var(--text); }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }

        h2 { text-align: center; color: var(--primary); margin-bottom: 20px; font-weight: 800; }

        /* Menu Tabs */
        .tabs {
            display: flex;
            background: #f1f5f9;
            padding: 4px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px;
            border: none;
            background: none;
            cursor: pointer;
            font-weight: 600;
            color: #64748b;
            transition: 0.2s;
            border-radius: 8px;
        }

        .tab-btn.active {
            background: white;
            color: var(--primary);
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        /* Content Sections */
        .content { display: none; }
        .content.active { display: block; }

        /* Form Styling */
        .form-group { margin-bottom: 16px; }
        label { display: block; margin-bottom: 6px; font-size: 14px; font-weight: 600; }
        select, textarea, .btn-save {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            font-size: 16px;
            background: white;
        }
        select:focus, textarea:focus { border-color: var(--primary); outline: none; }
        .row { display: flex; gap: 8px; }
        
        .btn-save {
            background: var(--success);
            color: white;
            border: none;
            font-weight: bold;
            margin-top: 10px;
            cursor: pointer;
        }

        /* Card Styling */
        .card {
            background: #fff;
            border: 1px solid #f1f5f9;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.02);
        }

        .bus-info b { font-size: 16px; color: var(--primary); display: block; }
        .bus-info span { font-size: 14px; font-weight: 500; }
        .bus-info small { color: #94a3b8; display: block; margin-top: 2px; }
        
        .btn-done {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 13px;
        }

        .history-card { border-left: 4px solid var(--success); opacity: 0.8; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ†Ô∏è Mekanik TP</h2>

    <div class="tabs">
        <button class="tab-btn active" data-target="tab-daftar">Pekerjaan</button>
        <button class="tab-btn" data-target="tab-input">Input</button>
        <button class="tab-btn" data-target="tab-riwayat">Riwayat</button>
    </div>

    <div id="tab-daftar" class="content active">
        <div id="listPekerjaan">Memuat data...</div>
    </div>

    <div id="tab-input" class="content">
        <form id="mechanicForm">
            <div class="form-group">
                <label>Nomor Lambung</label>
                <div class="row">
                    <select id="prefix" required>
                        <option value="A1">A1</option><option value="A2">A2</option><option value="A3">A3</option><option value="A4">A4</option>
                        <option value="B1">B1</option><option value="B2">B2</option><option value="B3">B3</option><option value="B4">B4</option>
                        <option value="C1">C1</option><option value="C2">C2</option><option value="C3">C3</option><option value="C4">C4</option>
                        <option value="BS">BS</option><option value="CAD">CAD</option>
                    </select>
                    <select id="number" required>
                        <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Jenis Perbaikan</label>
                <select id="jobType" required>
                    <option value="Ganti Oli">Ganti Oli</option>
                    <option value="Rem">Rem</option>
                    <option value="Kopling">Kopling</option>
                    <option value="Kelistrikan">Kelistrikan</option>
                    <option value="Mesin">Mesin</option>
                    <option value="AC">AC</option>
                </select>
            </div>
            <div class="form-group">
                <label>Keterangan</label>
                <textarea id="note" rows="2"></textarea>
            </div>
            <button type="submit" class="btn-save">SIMPAN DATA</button>
        </form>
    </div>

    <div id="tab-riwayat" class="content">
        <div id="listRiwayat"></div>
    </div>
</div>

<script type="module">
    // Import SDK Modular
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/9.17.1/firebase-database.js";

    // Konfigurasi Anda
    const firebaseConfig = {
        apiKey: "AIzaSyDCMPDUZc21Mgc0GtDSyyBCbSaJFvdYYAU",
        authDomain: "list-mekanik.firebaseapp.com",
        projectId: "list-mekanik",
        storageBucket: "list-mekanik.firebasestorage.app",
        messagingSenderId: "578557706347",
        appId: "1:578557706347:web:37e6cb783889a6c07b312e",
        databaseURL: "https://list-mekanik-default-rtdb.asia-southeast1.firebasedatabase.app"
    };

    // Inisialisasi
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Navigasi Tab
    const tabs = document.querySelectorAll('.tab-btn');
    tabs.forEach(btn => {
        btn.onclick = () => {
            tabs.forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById(btn.dataset.target).classList.add('active');
        };
    });

    // Simpan Data
    document.getElementById('mechanicForm').onsubmit = async (e) => {
        e.preventDefault();
        const lambung = `TP-${document.getElementById('prefix').value}-${document.getElementById('number').value}`;
        
        try {
            await push(ref(db, 'tugas'), {
                lambung,
                pekerjaan: document.getElementById('jobType').value,
                keterangan: document.getElementById('note').value,
                tanggal: new Date().toLocaleString('id-ID'),
                status: 'Aktif'
            });
            alert('Tersimpan!');
            document.getElementById('mechanicForm').reset();
            tabs[0].click(); // Balik ke tab daftar
        } catch (err) {
            alert('Gagal: ' + err.message);
        }
    };

    // Baca Data Realtime
    onValue(ref(db, 'tugas'), (snapshot) => {
        const listPekerjaan = document.getElementById('listPekerjaan');
        const listRiwayat = document.getElementById('listRiwayat');
        listPekerjaan.innerHTML = "";
        listRiwayat.innerHTML = "";

        snapshot.forEach((child) => {
            const item = child.val();
            const id = child.key;
            const html = `
                <div class="card ${item.status === 'Selesai' ? 'history-card' : ''}">
                    <div class="bus-info">
                        <b>${item.lambung}</b>
                        <span>${item.pekerjaan}</span>
                        <small>${item.status === 'Aktif' ? (item.keterangan || '') : item.tanggal}</small>
                    </div>
                    ${item.status === 'Aktif' ? `<button class="btn-done" data-id="${id}">Selesai</button>` : ''}
                </div>`;

            if (item.status === 'Aktif') listPekerjaan.innerHTML += html;
            else listRiwayat.innerHTML += html;
        });

        // Event listener untuk tombol selesai (delegasi)
        document.querySelectorAll('.btn-done').forEach(btn => {
            btn.onclick = () => {
                if(confirm('Pekerjaan selesai?')) {
                    update(ref(db, `tugas/${btn.dataset.id}`), { status: 'Selesai' });
                }
            };
        });

        if(!listPekerjaan.innerHTML) listPekerjaan.innerHTML = "<p align='center'>Kosong</p>";
    });
</script>
</body>
</html>

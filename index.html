<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Mekanik TP - Live</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }
        body { background-color: #f0f2f5; margin: 0; padding: 10px; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 15px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        
        h2 { text-align: center; color: #d32f2f; margin-bottom: 15px; }
        .menu-tabs { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 20px; }
        .tab-btn { flex: 1; min-width: 90px; padding: 10px; border: none; background: #e0e0e0; cursor: pointer; font-weight: bold; border-radius: 5px; }
        .tab-btn.active { background: #d32f2f; color: white; }

        .content-section { display: none; }
        .content-section.active { display: block; }

        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        select, textarea, button { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
        .row-flex { display: flex; gap: 8px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background: #f8f9fa; }

        .btn-submit { background: #2e7d32; color: white; border: none; font-weight: bold; cursor: pointer; }
        .btn-selesai { background: #1976d2; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; width: auto; }
        .status-done { color: #2e7d32; font-weight: bold; }
        .tgl-kecil { font-size: 11px; color: #777; display: block; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ†Ô∏è Mekanik Bus TP</h2>

    <div class="menu-tabs">
        <button class="tab-btn active" onclick="openTab('daftar')">Pekerjaan</button>
        <button class="tab-btn" onclick="openTab('input')">Input Baru</button>
        <button class="tab-btn" onclick="openTab('riwayat')">Riwayat</button>
    </div>

    <div id="daftar" class="content-section active">
        <table>
            <thead>
                <tr>
                    <th>Bus</th>
                    <th>Perbaikan</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="tabelAktif"></tbody>
        </table>
    </div>

    <div id="input" class="content-section">
        <form id="pekerjaanForm">
            <div class="form-group">
                <label>Nomor Lambung (TP)</label>
                <div class="row-flex">
                    <select id="kodeL" required>
                        <option value="">Kode</option>
                        <option value="A1">A1</option><option value="A2">A2</option><option value="A3">A3</option><option value="A4">A4</option>
                        <option value="B1">B1</option><option value="B2">B2</option><option value="B3">B3</option><option value="B4">B4</option>
                        <option value="C1">C1</option><option value="C2">C2</option><option value="C3">C3</option><option value="C4">C4</option>
                        <option value="BS">BS</option><option value="CAD">CAD</option>
                    </select>
                    <select id="nomorL" required>
                        <option value="">No</option>
                        <option value="01">01</option><option value="02">02</option><option value="03">03</option><option value="04">04</option><option value="05">05</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Jenis Perbaikan</label>
                <select id="jenisP" required>
                    <option value="">-- Pilih Jenis --</option>
                    <option value="Ganti Oli">Ganti Oli</option>
                    <option value="Service Rem">Service Rem</option>
                    <option value="Kopling">Kopling</option>
                    <option value="Kelistrikan">Kelistrikan</option>
                    <option value="AC Bus">Service AC</option>
                    <option value="Kaki-kaki">Kaki-kaki / Ban</option>
                    <option value="Mesin">Perbaikan Mesin</option>
                    <option value="Lain-lain">Lain-lain</option>
                </select>
            </div>
            <div class="form-group">
                <label>Keterangan</label>
                <textarea id="ket" rows="2" placeholder="Detail kerusakan..."></textarea>
            </div>
            <button type="submit" class="btn-submit">SIMPAN DATA</button>
        </form>
    </div>

    <div id="riwayat" class="content-section">
        <table>
            <thead>
                <tr>
                    <th>Bus & Tanggal</th>
                    <th>Pekerjaan</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="tabelRiwayat"></tbody>
        </table>
    </div>
</div>

<script>
    // Konfigurasi Firebase Anda
    const firebaseConfig = {
        apiKey: "AIzaSyDCMPDUZc21Mgc0GtDSyyBCbSaJFvdYYAU",
        authDomain: "list-mekanik.firebaseapp.com",
        projectId: "list-mekanik",
        storageBucket: "list-mekanik.firebasestorage.app",
        messagingSenderId: "578557706347",
        appId: "1:578557706347:web:37e6cb783889a6c07b312e",
        // databaseURL penting untuk Realtime Database
        databaseURL: "https://list-mekanik-default-rtdb.firebaseio.com" 
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Fungsi Tab
    function openTab(tabId) {
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        event.currentTarget.classList.add('active');
    }

    // Simpan Data
    document.getElementById('pekerjaanForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const lambung = `TP-${document.getElementById('kodeL').value}-${document.getElementById('nomorL').value}`;
        
        database.ref('tugas').push({
            lambung: lambung,
            pekerjaan: document.getElementById('jenisP').value,
            keterangan: document.getElementById('ket').value,
            tanggal: new Date().toLocaleString('id-ID'),
            status: 'Aktif'
        });

        document.getElementById('pekerjaanForm').reset();
        openTab('daftar');
        alert('Data ' + lambung + ' berhasil dikirim!');
    });

    // Baca Data (Realtime)
    database.ref('tugas').on('value', (snapshot) => {
        const tabelAktif = document.getElementById('tabelAktif');
        const tabelRiwayat = document.getElementById('tabelRiwayat');
        tabelAktif.innerHTML = "";
        tabelRiwayat.innerHTML = "";

        snapshot.forEach((child) => {
            const val = child.val();
            const id = child.key;

            if (val.status === 'Aktif') {
                tabelAktif.innerHTML += `<tr>
                    <td><strong>${val.lambung}</strong></td>
                    <td>${val.pekerjaan}<br><small>${val.keterangan}</small></td>
                    <td><button class="btn-selesai" onclick="tandaiSelesai('${id}')">Selesai</button></td>
                </tr>`;
            } else {
                tabelRiwayat.innerHTML += `<tr>
                    <td><strong>${val.lambung}</strong><span class="tgl-kecil">${val.tanggal}</span></td>
                    <td>${val.pekerjaan}</td>
                    <td class="status-done">SELESAI</td>
                </tr>`;
            }
        });
    });

    function tandaiSelesai(id) {
        if(confirm('Pindahkan ke riwayat?')) {
            database.ref('tugas/' + id).update({ status: 'Selesai' });
        }
    }
</script>
</body>
</html>
